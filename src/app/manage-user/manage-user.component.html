<main class="container mx-auto p-4">
	<h1 class="text-3xl font-bold text-center text-gray-800 dark:text-gray-200 mb-4">Utilisateurs</h1>

	<div class="relative overflow-x-auto">
		<!--<div class="flex flex-col gap-2 font-sans text-base font-normal text-blue-gray-700 px-2 overflow-y-auto h-screen">
			@for (user of users | async; track user){
				<div class="flex flex-row">
					<div class="w-4">
						{{ user.authorities }}
					</div>
					<div class="relative p-3 rounded-bl-lg rounded-tl-lg outline-none shadow text-start bg-white dark:bg-gray-900 flex flex-row justify-between truncate w-full md:w-lg">
						<p class="truncate">{{ user.username }} - {{ user.email }}<br> {{ user.authorities }}</p>
					</div>
					<button class="cursor-pointer bg-red-700 px-1.5 rounded-br-lg rounded-tr-lg">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
							<path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
						</svg>
					</button>
				</div>
			}
		</div>
-->

		<table class="w-full table-auto ">
			<thead>
				<tr>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Role</div>
						</div>
					</th>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Pseudo</div>
						</div>
					</th>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Email</div>
						</div>
					</th>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Actions</div>
						</div>
					</th>
				</tr>
			</thead>
			<tbody>
				@for (user of users$ | async; track user){
					<tr class="hover:bg-gray-200 dark:hover:bg-gray-700">
						<td class="border-b p-3 dark:border-gray-900">
							<span class="text-sm p-1.5 rounded-lg" [ngClass]="{'bg-red-500' : user.authorities?.includes('ADMIN'), 'bg-yellow-500' : user.authorities?.includes('STAFF'), 'bg-blue-500' : user.authorities?.includes('TECH'), 'bg-gray-500' : user.authorities?.includes('LOCKED')}">{{ user.authorities }}</span>
						</td>
						<td class="border-b p-3 dark:border-gray-900">
							<span>{{user.username}}</span>
						</td>
						<td class="border-b p-3 dark:border-gray-900">
							<span>{{user.email}}</span>
						</td>
						<td class="border-b p-3 text-center dark:border-gray-900">
							@if (user.username != authService.getUsername()){
								<div class="flex flex-row gap-2">
									<button class="p-2 bg-red-700 rounded-lg cursor-pointer hover:bg-red-800">Supprimer</button>
									@if (user.isEnable){
										<button class="p-2 bg-red-700 cursor-pointer rounded-lg hover:bg-red-800" (click)="disableUser(user.id!)" [tooltip]="'Empecher l\'utilisateur de se connecter'">Bloquer</button>
									} @else {
										<button class="p-2 bg-green-700 cursor-pointer rounded-lg hover:bg-green-800" (click)="enableUser(user.id!)" [tooltip]="'Permettre à l\'utilisateur de se connecter'">Débloquer</button>
									}
									<select class="p-2 rounded-lg bg-white text-gray-900 dark:bg-gray-900 dark:text-white" (change)="changeRole($event, user.id!)" [tooltip]="'Changer le role de l\'utilisateur'">
										@for (authority of enumKeysAuthority(Authority); track authority){
											<option class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white" [value]="authority" [selected]="user.authorities?.includes(authority)">{{ authority | titlecase }}</option>
										}
									</select>
								</div>
							} @else {
								<p>Actions non disponible</p>
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</main>
