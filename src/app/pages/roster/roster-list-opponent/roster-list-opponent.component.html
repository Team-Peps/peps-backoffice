<main class="container mx-auto p-4">
	<h1 class="text-3xl font-bold text-center text-gray-800 dark:text-gray-200 mb-4">Equipes adverses</h1>

	<div class="relative flex flex-col gap-4">

		<div class="flex flex-col md:flex-row gap-2">
			@if (!isAddOpponentRoster && !isEditOpponentRoster) {
				<button class="p-2 bg-blue-700 rounded-lg cursor-pointer hover:bg-blue-600 text-white w-fit" (click)="wantAddOpponentRoster()">Ajouter une équipe adverse</button>
			} @else {
				<form [formGroup]="opponentRosterForm" class="text-gray-900 dark:text-gray-100">
					<div class="flex flex-col md:flex-row gap-4">
						<input type="text" id="name" formControlName="name" class="p-2 border border-gray-300 rounded-lg" placeholder="Nom de l'équipe"/>
						<select class="p-2.5 rounded-lg border border-gray-300" id="game" formControlName="game">
							<option class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white" value="overwatch" selected>Overwatch</option>
							<option class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white" value="marvel-rivals">Marvel Rivals</option>
						</select>
						<button class="p-2 bg-red-700 rounded-lg cursor-pointer hover:bg-red-600 text-white w-fit" (click)="cancelAddOrEditOpponentRoster()">Annuler</button>
						<button class="p-2 rounded-lg bg-blue-700 hover:bg-blue-600 text-white w-fit" [ngClass]="{'cursor-not-allowed': isButtonDisabled, 'cursor-pointer': !isButtonDisabled}" (click)="isAddOpponentRoster ? createOpponentRoster() : updateOpponentRoster()" [disabled]="isButtonDisabled">{{ isAddOpponentRoster ? 'Ajouter' : 'Mettre à jour' }}</button>
					</div>
				</form>
			}

		</div>

		<div class="relative overflow-x-auto">

			<table class="w-full table-auto ">
				<thead>
				<tr>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Jeu</div>
						</div>
					</th>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Equipe</div>
						</div>
					</th>
					<th class="border-b border-t border-gray-900 bg-gray-900 text-white">
						<div class="flex items-center px-2 py-1">
							<div class="flex-1 text-left font-normal">Actions</div>
						</div>
					</th>
				</tr>
				</thead>
				<tbody>
					@for (roster of rosters$ | async; track roster){
						<tr class="hover:bg-gray-200 dark:hover:bg-gray-700">
							<td class="border-b p-3 dark:border-gray-900">
								<div class="flex flex-row items-center gap-2">
									<div class="rounded-lg p-2 bg-gray-300 dark:bg-gray-950">
										<img [src]="'assets/'+ roster.game+'.svg'" alt="Logo {{roster.game}}" class="w-10 h-10 inline-block mr-2">
										<span>{{ roster.game | replace: '-' : ' ' | titlecase }}</span>
									</div>
								</div>
							</td>
							<td class="border-b p-3 dark:border-gray-900">
								{{ roster.name }}
							</td>
							<td class="border-b p-3 dark:border-gray-900">
								<div class="flex flex-row gap-2">
									<button class="p-2 bg-blue-700 rounded-lg cursor-pointer hover:bg-blue-600 text-white" (click)="wantEditOpponentRoster(roster)">Modifier</button>
									<!--<button class="p-2 bg-blue-700 rounded-lg cursor-not-allowed hover:bg-blue-600 text-white" [routerLink]="['/management/opponents/' + roster.id]" disabled>Voir</button>-->
									@if (roster.matchCount! < 1) {
										<button class="p-2 bg-red-700 rounded-lg cursor-pointer hover:bg-red-600 text-white" (click)="wantDeleteRoster(roster)">Supprimer</button>
									}
								</div>
							</td>
						</tr>
					}
				</tbody>
			</table>

		</div>
	</div>

	@if(rosterToDelete){
		<app-modal
			[title]="'Suppression de l\'équipe ' + rosterToDelete?.name"
			[content]="'Êtes-vous sûr de vouloir supprimer cette équipe ?'"
			[action]="'Supprimer'"
			[type]="'danger'"
			(okAction)="deleteRoster()"
			(closeAction)="cancelDeleteRoster()"
		/>
	}
</main>
